pyjwt, AuthX

–í–≤–µ–¥–µ–Ω–∏–µ –≤ OAuth 
https://dzen.ru/a/XsTMHgM7H2vsTOg2

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python:
Authlib

–ö–æ–Ω—Å–æ–ª—å Google
https://console.cloud.google.com/

https://developers.google.com/identity/protocols/oauth2?hl=ru
https://developers.google.com/identity/openid-connect/openid-connect?hl=ru#obtainuserinfo

{'sub': '', 
'name': '–ê –•', 
'given_name': '–ê', 
'family_name': '–•', 
'picture': 'https://lh3.googleusercontent.com/', 
'email': 'example@gmail.com', 
'email_verified': True}

–∫–æ–Ω—Å–æ–ª—å GitHub
https://github.com/settings/apps

{'login': '..., 
'id': ..., 
'node_id': '...', 
'avatar_url': 'https://avatars.githubusercontent.com/u/...v=4', 
'gravatar_id': '', 
'url': 'https://api.github.com/users/...', 
'html_url': 'https://github.com/...', 
'followers_url': 'https://api.github.com/users/.../followers', 
'following_url': 'https://api.github.com/users/.../following{/other_user}', 
'gists_url': 'https://api.github.com/users/.../gists{/gist_id}', 
'starred_url': 'https://api.github.com/users/.../starred{/owner}{/repo}', 
'subscriptions_url': 'https://api.github.com/users/.../subscriptions', 
'organizations_url': 'https://api.github.com/users/.../orgs', 
'repos_url': 'https://api.github.com/users/.../repos', 
'events_url': 'https://api.github.com/users/.../events{/privacy}', 
'received_events_url': 'https://api.github.com/users/.../received_events', 
'type': 'User', 
'user_view_type': 'private', 
'site_admin': False, 
'name': 'A', 
'company': None, 
'blog': '', 
'location': 'Moscow, Some_City', 
'email': 'example@ya.ru', 
'hireable': True, 
'bio': None, 
'twitter_username': None, 
'notification_email': 'example@ya.ru', 
'public_repos': 12, 
'public_gists': 0, 
'followers': 0, 
'following': 2, 
'created_at': '2020-08-24T04:56:43Z', 
'updated_at': '2020-08-10T21:29:30Z', 
'private_gists': 0, 
'total_private_repos': 2, 
'owned_private_repos': 2, 
'disk_usage': 57373, 
'collaborators': 0, 
'two_factor_authentication': True, 
'plan': {'name': 'free', 'space': 976500099, 'collaborators': 0, 'private_repos': 10000}}

### –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Google
[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] 

    ‚Üì (1) Google OAuth Login

[Flet] 

    ‚Üì (2) ID Token
[FastAPI] 

    ‚Üì (3) –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ Google —Ç–æ–∫–µ–Ω–∞
[FastAPI] 

    ‚Üì (4) –°–æ–∑–¥–∞–Ω–∏–µ/–ø–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
[FastAPI] 

    ‚Üì (5) –í—ã–¥–∞—á–∞ JWT –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
[Flet] 

    ‚Üì (6) –ó–∞–ø—Ä–æ—Å—ã –∫ API —Å JWT
[FastAPI]

    ‚Üì (7) –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT, –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

üî∏ –ü–æ–¥—Ä–æ–±–Ω–æ –ø–æ —à–∞–≥–∞–º
1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

Flet –≤—ã–∑—ã–≤–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º page.login() (–∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π OAuth flow) –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç Google ID Token.

–≠—Ç–æ—Ç ID Token ‚Äî —ç—Ç–æ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π JWT, –≤ –∫–æ—Ç–æ—Ä–æ–º –µ—Å—Ç—å:

sub ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Google

email

name

picture

iss ‚Äî https://accounts.google.com

aud ‚Äî —Ç–≤–æ–π client_id

exp ‚Äî —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∞

2. –ü–µ—Ä–µ–¥–∞—á–∞ ID Token –Ω–∞ –±—ç–∫–µ–Ω–¥

–í–º–µ—Å—Ç–æ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ page.auth.user –Ω–∞ –±—ç–∫–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ ID Token:

```python

httpx.post(
    "https://api.example.com/auth/google",
    json={"id_token": page.auth.token["id_token"]}
)
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

–í FastAPI:

```python
from google.oauth2 import id_token
from google.auth.transport import requests

def verify_google_token(token: str):
    idinfo = id_token.verify_oauth2_token(token, requests.Request(), GOOGLE_CLIENT_ID)
    return idinfo  # —Å–ª–æ–≤–∞—Ä—å —Å sub, email, name, picture, ...
```
–ó–¥–µ—Å—å FastAPI –ø—Ä–æ–≤–µ—Ä–∏—Ç –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞ Google, –∞—É–¥–∏—Ç–æ—Ä–∏—é –∏ —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏.

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Ñ–µ–π–∫–æ–≤—ã–π –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª ‚Äî —Å—Ä–∞–∑—É 401.

4. –ü–æ–∏—Å–∫ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î

–í PostgreSQL:

–ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ sub (Google ID) –∏–ª–∏ email.

–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤ users:

```sql

id | email          | name     | avatar_url | provider | provider_id
---+----------------+----------+------------+----------+-------------
 1 | user@mail.com  | Alice    | ...        | google   | 1122334455
```
 
# –í–∞–º –Ω–µ –Ω—É–∂–µ–Ω JWT –¥–ª—è –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –≤–∞—à–∏–º Flet-–∫–ª–∏–µ–Ω—Ç–æ–º –∏ –≤–∞—à–∏–º –∂–µ –±—ç–∫–µ–Ω–¥–æ–º. 

page.session –∏–¥–µ–∞–ª—å–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —Ä–æ–ª—å—é —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –†–æ–ª—å –±—ç–∫–µ–Ω–¥–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π, –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –∏ –æ—Ç–¥–∞—Ç—å –µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Å–µ—Å—Å–∏–∏.

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—É—é –¥–∏–ª–µ–º–º—É –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Flet.

**–ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç:** –ù–µ—Ç, –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å JWT —Ç–æ–∫–µ–Ω —Å –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ **–Ω–µ –Ω—É–∂–Ω–æ** –∏ —ç—Ç–æ –±—ã–ª–æ –±—ã –∏–∑–±—ã—Ç–æ—á–Ω–æ. –°–µ—Å—Å–∏—è Flet (`page.session`) ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –≤–∞—à –º–µ—Ö–∞–Ω–∏–∑–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.

–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ, –ø–æ—á–µ–º—É —ç—Ç–æ —Ç–∞–∫ –∏ –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—Å—Ç—Ä–æ–∏—Ç—åÊµÅÁ®ã.

### 1. –†–æ–ª—å `page.session` –≤ Flet

Flet ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫, —ç—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–∞—à–µ Flet-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –º–µ–∂–¥—É –±—Ä–∞—É–∑–µ—Ä–æ–º (–∫–ª–∏–µ–Ω—Ç–æ–º) –∏ —Å–µ—Ä–≤–µ—Ä–æ–º Flet —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è **–¥–æ–ª–≥–æ–∂–∏–≤—É—â–µ–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** (—á–µ—Ä–µ–∑ WebSockets).

`page.session` ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ *–∫–ª–∏–µ–Ω—Ç–∞*, –∫–æ—Ç–æ—Ä–æ–µ:
*   –ü—Ä–∏–≤—è–∑–∞–Ω–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ –±—Ä–∞—É–∑–µ—Ä–∞.
*   –°—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –≤—Å–µ–π –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–∏ (–ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–∫—Ä–æ–µ—Ç –≤–∫–ª–∞–¥–∫—É).
*   **–Ø–≤–ª—è–µ—Ç—Å—è –∏–¥–µ–∞–ª—å–Ω—ã–º –º–µ—Å—Ç–æ–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–∫—Ç–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.**

–í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å —Å–≤–æ–π –≤–µ–ª–æ—Å–∏–ø–µ–¥ —Å JWT –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ Flet —É–∂–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–ª—è —ç—Ç–æ–≥–æ –≥–æ—Ç–æ–≤—ã–π, –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ —É–¥–æ–±–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º ‚Äî `page.session`.

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–í–æ—Ç –∫–∞–∫ –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—åÊµÅÁ®ã (flow):

1.  **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (Flet) –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞:**
    *   –í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–±–∏–±–ª–∏–æ—Ç–µ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `google_sign_in` –¥–ª—è Flutter –∏–ª–∏ JS-–±–∏–±–ª–∏–æ—Ç–µ–∫—É Google) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `access_token` –æ—Ç Google/GitHub –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞.

2.  **–§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–µ—Ä–µ–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω –Ω–∞ –±—ç–∫–µ–Ω–¥ (FastAPI):**
    *   Flet-–∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `httpx`) –Ω–∞ –≤–∞—à —ç–Ω–¥–ø–æ–∏–Ω—Ç FastAPI, —Å–∫–∞–∂–µ–º, `POST /auth/google`, –ø–µ—Ä–µ–¥–∞–≤–∞—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π `access_token`.
    *   **–í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ HTTPS –¥–ª—è –∑–∞—â–∏—Ç—ã —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ.

3.  **–ë—ç–∫–µ–Ω–¥ (FastAPI) –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ:**
    *   FastAPI-—Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç `access_token`.
    *   –°–µ—Ä–≤–µ—Ä —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ `https://www.googleapis.com/oauth2/v3/userinfo`) —Å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`email`, `name`, `id` –∏ —Ç.–¥.).
    *   **–ó–¥–µ—Å—å –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç: –±—ç–∫–µ–Ω–¥ –¥–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–º—É, —á—Ç–æ —Å–∫–∞–∑–∞–ª –µ–º—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –∞ –Ω–µ —Ç–æ–º—É, —á—Ç–æ –ø—Ä–∏—Å–ª–∞–ª –∫–ª–∏–µ–Ω—Ç.** –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–æ–¥–¥–µ–ª–∫–∏ —Ç–æ–∫–µ–Ω–∞.

4.  **–ë—ç–∫–µ–Ω–¥ —Å–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î:**
    *   –ù–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ `email` –∏–ª–∏ `id` –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –±—ç–∫–µ–Ω–¥ –∏—â–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≤–∞—à–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–≥–æ.
    *   –ë—ç–∫–µ–Ω–¥ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–π **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á `user_id` –∏–∑ –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã `users`). –≠—Ç–æ—Ç ID ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–ª—è –≤–∞—à–µ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏.

5.  **–ë—ç–∫–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É:**
    *   –ë—ç–∫–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ Flet-–∫–ª–∏–µ–Ω—Ç. –í –æ—Ç–≤–µ—Ç–µ **–ù–ï JWT**, –∞ –ø—Ä–æ—Å—Ç–æ —Ñ–∞–∫—Ç —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏, –≤–æ–∑–º–æ–∂–Ω–æ, —Ç–æ—Ç —Å–∞–º—ã–π **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `user_id`** (–∏–ª–∏ username, email) –∏ –¥—Ä—É–≥–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –Ω—É–∂–Ω–∞—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è UI (–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞–≤–∞—Ç–∞—Ä).
    *   –û—Ç–≤–µ—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º: `{"success": true, "user_id": 123, "email": "user@example.com", "full_name": "John Doe"}`.

6.  **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (Flet) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–µ—Å—Å–∏–∏:**
    *   –ü–æ–ª—É—á–∏–≤ —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç –±—ç–∫–µ–Ω–¥–∞, Flet-–∫–ª–∏–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `page.session`.
    ```python
    # –ü—Ä–∏–º–µ—Ä –Ω–∞ Flet
    import httpx
    # ... —à–∞–≥–∏ 1-2 ...
    
    # –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –º—ã –ø–æ–ª—É—á–∏–ª–∏ —Ç–æ–∫–µ–Ω –æ—Ç Google –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
    provider_token = ... 

    # –®–∞–≥ 2-3: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–∫–µ–Ω–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥
    async with httpx.AsyncClient() as client:
        response = await client.post(
            "https://your-fastapi-backend.com/auth/google",
            json={"token": provider_token}
        )
        if response.status_code == 200:
            data = response.json()
            # –®–∞–≥ 6: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Å–µ—Å—Å–∏—é
            page.session.set("user_authenticated", True)
            page.session.set("user_id", data["user_id"])
            page.session.set("user_email", data["email"])
            page.session.set("user_name", data["full_name"])
            
            # –û–±–Ω–æ–≤–ª—è–µ–º UI (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É –∏ –∫–Ω–æ–ø–∫—É "–í—ã–π—Ç–∏")
            update_ui_after_login()
        else:
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
            show_error_dialog()
    ```

7.  **–î–∞–ª—å–Ω–µ–π—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –±—ç–∫–µ–Ω–¥—É:**
    *   –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –≤—ã–∑–æ–≤–∞—Ö –≤–∞—à–µ–≥–æ FastAPI –±—ç–∫–µ–Ω–¥–∞ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö), Flet-–∫–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –∑–∞–ø—Ä–æ—Å–µ —Ç–æ—Ç —Å–∞–º—ã–π **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `user_id`** (–∏–ª–∏ –¥—Ä—É–≥–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä), –∫–æ—Ç–æ—Ä—ã–π –æ–Ω —Å–æ—Ö—Ä–∞–Ω–∏–ª –≤ —Å–µ—Å—Å–∏–∏.
    *   –ë—ç–∫–µ–Ω–¥ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–æ—Ç ID –∏ —Ä–µ—à–∞—Ç—å, –∏–º–µ–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∞–≤–æ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–º –¥–∞–Ω–Ω—ã–º.
    *   **–í–∞–∂–Ω–æ:** –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ endpoints –Ω–∞ FastAPI –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å —ç—Ç–æ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

### –†–µ–∑—é–º–µ: –ö—Ç–æ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç?

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç? | –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç? |
| :--- | :--- | :--- |
| **–§—Ä–æ–Ω—Ç–µ–Ω–¥ (Flet)** | –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞. –ü–µ—Ä–µ–¥–∞–µ—Ç –µ–≥–æ –Ω–∞ –±—ç–∫–µ–Ω–¥. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç –±—ç–∫–µ–Ω–¥–∞ (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) –≤ `page.session`. | `page.session['user_id']`, `page.session['user_email']` |
| **–ë—ç–∫–µ–Ω–¥ (FastAPI)** | **–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç** —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞. –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°–æ–∑–¥–∞–µ—Ç/–∏—â–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π ID**. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É. | –í–∞—à–∞ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ç–∞–±–ª–∏—Ü–µ–π `users`. –°–≤—è–∑—å `google_id` -> `user_id`. |
| **–ü—Ä–æ–≤–∞–π–¥–µ—Ä (Google)** | –í—ã–¥–∞–µ—Ç —Ç–æ–∫–µ–Ω. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —ç—Ç–æ–º—É —Ç–æ–∫–µ–Ω—É. | –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–≤–æ–µ–º –∞–∫–∫–∞—É–Ω—Ç–µ. |

**–ò—Ç–æ–≥:** –í–∞–º –Ω–µ –Ω—É–∂–µ–Ω JWT –¥–ª—è –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –≤–∞—à–∏–º Flet-–∫–ª–∏–µ–Ω—Ç–æ–º –∏ –≤–∞—à–∏–º –∂–µ –±—ç–∫–µ–Ω–¥–æ–º. `page.session` –∏–¥–µ–∞–ª—å–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —Ä–æ–ª—å—é —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –†–æ–ª—å –±—ç–∫–µ–Ω–¥–∞ ‚Äî –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ç–æ–∫–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π, –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –ø—Ä–æ—Å—Ç–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è *–≤ –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ* –∏ –æ—Ç–¥–∞—Ç—å –µ–≥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Å–µ—Å—Å–∏–∏.